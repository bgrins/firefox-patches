# HG changeset patch
# Parent  2c9f37ff7f0d76a31beb333db9e00e3afc264e32

diff --git a/browser/components/sessionstore/PageWireframes.sys.mjs b/browser/components/sessionstore/PageWireframes.sys.mjs
--- a/browser/components/sessionstore/PageWireframes.sys.mjs
+++ b/browser/components/sessionstore/PageWireframes.sys.mjs
@@ -64,6 +64,12 @@ export const PageWireframes = {
    *   The rendered wireframe
    */
   getWireframeElement(wireframe, document) {
+    console.log(
+      "getWireframeElement",
+      wireframe.version,
+      wireframe.width,
+      wireframe.height
+    );
     const SVG_NS = "http://www.w3.org/2000/svg";
     let svg = document.createElementNS(SVG_NS, "svg");
 
diff --git a/dom/base/Document.cpp b/dom/base/Document.cpp
--- a/dom/base/Document.cpp
+++ b/dom/base/Document.cpp
@@ -15339,6 +15339,12 @@ void Document::GetWireframeWithoutFlushi
   auto& wireframe = aWireframe.SetValue();
   wireframe.mCanvasBackground = shell->ComputeCanvasBackground().mViewportColor;
 
+  nsRect visibleArea = pc->GetVisibleArea();
+  CSSSize visibleAreaCSS = CSSPixel::FromAppUnits(visibleArea.Size());
+  wireframe.mWidth = std::roundf(visibleAreaCSS.width);
+  wireframe.mHeight = std::roundf(visibleAreaCSS.height);
+  printf_stderr("wireframe size: %fx%f\n", wireframe.mWidth, wireframe.mHeight);
+
   FrameForPointOptions options;
   options.mBits += FrameForPointOption::IgnoreCrossDoc;
   options.mBits += FrameForPointOption::IgnorePaintSuppression;
@@ -15346,8 +15352,7 @@ void Document::GetWireframeWithoutFlushi
 
   AutoTArray<nsIFrame*, 32> frames;
   const RelativeTo relativeTo{rootFrame, mozilla::ViewportType::Layout};
-  nsLayoutUtils::GetFramesForArea(relativeTo, pc->GetVisibleArea(), frames,
-                                  options);
+  nsLayoutUtils::GetFramesForArea(relativeTo, visibleArea, frames, options);
 
   // TODO(emilio): We could rewrite hit testing to return nsDisplayItem*s or
   // something perhaps, but seems hard / like it'd involve at least some extra
diff --git a/dom/webidl/Document.webidl b/dom/webidl/Document.webidl
--- a/dom/webidl/Document.webidl
+++ b/dom/webidl/Document.webidl
@@ -746,8 +746,10 @@ dictionary WireframeTaggedRect {
 [GenerateInit]
 dictionary Wireframe {
   unsigned long canvasBackground = 0; // in nscolor format
+  unrestricted double width = 0;
+  unrestricted double height = 0;
   sequence<WireframeTaggedRect> rects;
-  unsigned long version = 1; // Increment when the wireframe structure changes in backwards-incompatible ways
+  unsigned long version = 2; // Increment when the wireframe structure changes in backwards-incompatible ways
 };
 partial interface Document {
   [ChromeOnly]
